{"version":3,"names":["isPrintableCharacter","key","length","match","TypeAheadHandler","constructor","optionNodes","this","typeAheadQuery","getElementByQuery","query","toLowerCase","values","_options","map","option","textContent","trim","index","findIndex","value","currentIndex","indexOf","matchingLabel","sort","find","typeAhead","currentElement","focusableElement","focusInnerOrFocus","clearTimeout","typeAheadTimeout","window","setTimeout","options","Array","isArray","from"],"sources":["../src/liquid/utils/typeahead.ts"],"sourcesContent":["import { focusInnerOrFocus } from './focus'\n\nconst isPrintableCharacter = (key: string) =>\n  key.length === 1 && key.match(/\\S/)\n\nexport class TypeAheadHandler<T extends HTMLElement> {\n  private currentIndex: number\n  private typeAheadQuery = ''\n  private typeAheadTimeout: number\n  private _options: T[]\n\n  constructor(optionNodes: NodeListOf<T> | T[]) {\n    this.options = optionNodes\n  }\n\n  set options(optionNodes: NodeListOf<T> | T[]) {\n    this._options = Array.isArray(optionNodes)\n      ? optionNodes\n      : Array.from(optionNodes)\n  }\n\n  private getElementByQuery = () => {\n    if (!this.typeAheadQuery) return\n\n    const query = this.typeAheadQuery.toLowerCase()\n    const values = this._options.map((option) =>\n      option.textContent.trim().toLowerCase()\n    )\n    let index = values.findIndex(\n      (value, index) => index > this.currentIndex && value.indexOf(query) === 0\n    )\n\n    // only search again from index 0, if you previously started from an index > 0\n    if (index === -1 && this.currentIndex > -1) {\n      index = values.findIndex((value) => value.indexOf(query) === 0)\n    }\n\n    if (index > -1) {\n      return this._options[index]\n    }\n\n    // find the first value that is alphabetically following the query\n    const matchingLabel = [...values].sort().find((value) => query < value)\n\n    if (matchingLabel) {\n      return this._options[values.indexOf(matchingLabel)]\n    }\n  }\n\n  clearTimeout() {\n    window.clearTimeout(this.typeAheadTimeout)\n  }\n\n  /**\n   * Type a character: focus moves to the next item with a name that starts\n   * with the typed character. Type multiple characters in rapid succession:\n   * focus moves to the next item with a name that starts with the string of\n   * characters typed.\n   * @param key typed key\n   * @returns The focused element, if any\n   */\n  typeAhead = (key: string, currentElement?: T) => {\n    if (!isPrintableCharacter(key)) {\n      return\n    }\n\n    // set the current index only once while adding to a typeahead query\n    if (!this.typeAheadQuery) {\n      this.currentIndex = currentElement\n        ? this._options.indexOf(currentElement)\n        : -1\n    }\n\n    this.typeAheadQuery = this.typeAheadQuery + key\n\n    const focusableElement = this.getElementByQuery()\n\n    if (focusableElement) {\n      focusInnerOrFocus(focusableElement)\n    }\n\n    this.clearTimeout()\n    this.typeAheadTimeout = window.setTimeout(() => {\n      this.typeAheadQuery = ''\n    }, 500)\n\n    return focusableElement\n  }\n}\n"],"mappings":"oCAEA,MAAMA,EAAwBC,GAC5BA,EAAIC,SAAW,GAAKD,EAAIE,MAAM,M,MAEnBC,EAMXC,YAAYC,GAJJC,KAAAC,eAAiB,GAcjBD,KAAAE,kBAAoB,KAC1B,IAAKF,KAAKC,eAAgB,OAE1B,MAAME,EAAQH,KAAKC,eAAeG,cAClC,MAAMC,EAASL,KAAKM,SAASC,KAAKC,GAChCA,EAAOC,YAAYC,OAAON,gBAE5B,IAAIO,EAAQN,EAAOO,WACjB,CAACC,EAAOF,IAAUA,EAAQX,KAAKc,cAAgBD,EAAME,QAAQZ,KAAW,IAI1E,GAAIQ,KAAW,GAAKX,KAAKc,cAAgB,EAAG,CAC1CH,EAAQN,EAAOO,WAAWC,GAAUA,EAAME,QAAQZ,KAAW,G,CAG/D,GAAIQ,GAAS,EAAG,CACd,OAAOX,KAAKM,SAASK,E,CAIvB,MAAMK,EAAgB,IAAIX,GAAQY,OAAOC,MAAML,GAAUV,EAAQU,IAEjE,GAAIG,EAAe,CACjB,OAAOhB,KAAKM,SAASD,EAAOU,QAAQC,G,GAgBxChB,KAAAmB,UAAY,CAACzB,EAAa0B,KACxB,IAAK3B,EAAqBC,GAAM,CAC9B,M,CAIF,IAAKM,KAAKC,eAAgB,CACxBD,KAAKc,aAAeM,EAChBpB,KAAKM,SAASS,QAAQK,IACrB,C,CAGPpB,KAAKC,eAAiBD,KAAKC,eAAiBP,EAE5C,MAAM2B,EAAmBrB,KAAKE,oBAE9B,GAAImB,EAAkB,CACpBC,EAAkBD,E,CAGpBrB,KAAKuB,eACLvB,KAAKwB,iBAAmBC,OAAOC,YAAW,KACxC1B,KAAKC,eAAiB,EAAE,GACvB,KAEH,OAAOoB,CAAgB,EA1EvBrB,KAAK2B,QAAU5B,C,CAGb4B,YAAQ5B,GACVC,KAAKM,SAAWsB,MAAMC,QAAQ9B,GAC1BA,EACA6B,MAAME,KAAK/B,E,CA+BjBwB,eACEE,OAAOF,aAAavB,KAAKwB,iB"}